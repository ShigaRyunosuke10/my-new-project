# テストガイド - 工数管理スプレッドシート

**作成日**: 2025-10-10
**対象**: バグ修正後の動作確認

---

## 📋 テスト実施手順

### 事前準備

1. スプレッドシートを開く
2. ブラウザのデベロッパーツールを開く（F12キー）
3. 「コンソール」タブを開いておく（エラー確認用）

---

## ✅ テストケース一覧

### 1. Critical修正の確認

#### Test 1-1: 配列範囲外アクセスの保護

**目的**: ヘッダー列が変わってもクラッシュしないことを確認

**手順**:
1. スプレッドシートエディタを開く
2. **拡張機能 > Apps Script** を選択
3. 左側のメニューから「実行数」を選択
4. スプレッドシートに戻り、メインシートで適当なセルを編集
5. 再度Apps Scriptエディタに戻り、「実行数」を確認

**期待結果**:
- エラーログに「列インデックスが取得できません」というメッセージが出る（ヘッダーが正常な場合は出ない）
- スクリプトがクラッシュしない

**ログ取得方法**:
```
1. Apps Scriptエディタを開く
2. 左側メニューの「実行数」をクリック
3. 最新の実行ログをコピー
```

---

#### Test 1-2: ロックタイムアウトの最適化

**目的**: 複数ユーザー同時編集時の応答性を確認

**手順**:
1. メインシートで適当なセルを編集
2. すぐに別のセルを編集（5秒以内）

**期待結果**:
- 2回目の編集もスムーズに反映される
- 「ロックの待機中にタイムアウトしました」のログが出ない

**ログ取得方法**:
```
Apps Scriptエディタ > 実行数 > 最新の実行ログをコピー
```

---

#### Test 1-3: ユニークキー重複によるデータ消失防止

**目的**: 空の管理No/作業区分がスキップされることを確認

**手順**:
1. メインシートに新しい行を追加
2. 「担当者」だけ入力し、「管理No」と「作業区分」は空にする
3. カスタムメニュー > 「表示を更新」を実行

**期待結果**:
- ログに「データスキップ: 管理No「」作業区分「」が空です」と記録される
- 他のデータは正常に処理される

**ログ取得方法**:
```
Apps Scriptエディタ > 実行数 > 「表示を更新」の実行ログをコピー
```

---

#### Test 1-4: 仕掛かり日の妥当性チェック

**目的**: 無効な日付が拒否されることを確認

**手順**:
1. メインシートで「機番」「機種」が入力されている行を選択
2. 「仕掛日」列に無効な値を入力（例: 「abc」「99/99/99」）

**期待結果**:
- ログに「無効な日付が入力されました: abc」と記録される
- 管理表が作成されない

**ログ取得方法**:
```
Apps Scriptエディタ > 実行数 > 最新の実行ログをコピー
```

---

### 2. Major修正の確認

#### Test 2-1: エラーハンドリングの改善

**目的**: エラーがユーザーに通知されることを確認

**手順**:
1. カスタムメニューから「全資料フォルダ作成」を実行
2. （もしエラーが発生する場合）画面右下のトースト通知を確認

**期待結果**:
- エラーが発生した場合、画面右下にエラーメッセージが表示される
- ログにも同じエラーメッセージが記録される

**ログ取得方法**:
```
Apps Scriptエディタ > 実行数 > 「全資料フォルダ作成」の実行ログをコピー
```

---

### 3. Minor修正の確認

#### Test 3-1: エラーの握りつぶし修正

**目的**: キャッシュパースエラーが適切に処理されることを確認

**手順**:
1. カスタムメニュー > 「スクリプトのキャッシュをクリア」を実行
2. メインシートで適当なセルを編集（キャッシュが再生成される）
3. ログを確認

**期待結果**:
- 「キャッシュのパースエラー」のログが出ない（正常時）
- もし破損キャッシュがあれば、「キャッシュのパースエラー」→削除のログが出る

**ログ取得方法**:
```
Apps Scriptエディタ > 実行数 > 最新の実行ログをコピー
```

---

#### Test 3-2: キャッシュクリアの動的取得

**目的**: キャッシュクリアが全てのマスタシートに対応していることを確認

**手順**:
1. カスタムメニュー > 「スクリプトのキャッシュをクリア」を実行
2. 画面右下のトースト通知を確認

**期待結果**:
- 「スクリプトのキャッシュをクリアしました。」のトースト通知が表示される
- ログに「スクリプトのキャッシュがクリアされました。」と記録される

**ログ取得方法**:
```
Apps Scriptエディタ > 実行数 > 「スクリプトのキャッシュをクリア」の実行ログをコピー
```

---

## 📊 ログの取得とコピペ方法

### 方法1: Apps Scriptエディタから取得（推奨）

```
1. スプレッドシートを開く
2. 拡張機能 > Apps Script をクリック
3. 左側メニューの「実行数」（⚡アイコン）をクリック
4. 確認したい実行を選択
5. ログ内容をコピー
```

### 方法2: ブラウザのコンソールから取得

```
1. スプレッドシートを開く
2. F12キーでデベロッパーツールを開く
3. 「コンソール」タブを選択
4. 操作を実行
5. console.logの内容をコピー
```

---

## 🔍 エラーの見分け方

### 正常なログの例

```
[2025-10-10 12:00:00] スクリプトのキャッシュがクリアされました。
```

### エラーログの例

```
[2025-10-10 12:00:00] キャッシュのパースエラー (color_map_進捗マスタ): Unexpected token
[2025-10-10 12:00:00] 管理表の作成中にエラー: Permission denied
```

---

## 📝 テスト結果の報告フォーマット

テスト実施後、以下の形式で結果をコピペしてください：

```
## テスト結果

### Test 1-1: 配列範囲外アクセスの保護
- 結果: ✅ 成功 / ❌ 失敗
- ログ:
[ここにログをコピペ]

### Test 1-2: ロックタイムアウトの最適化
- 結果: ✅ 成功 / ❌ 失敗
- ログ:
[ここにログをコピペ]

（以下同様）
```

---

## ⚠️ 注意事項

- テスト実施前に必ずバックアップを取得してください
- 本番データでテストする場合は、十分注意してください
- エラーが発生しても、ログが取れれば修正可能です

---

**このガイドは自動生成されました by Claude Code**
