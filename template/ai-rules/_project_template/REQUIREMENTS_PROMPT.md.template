# 対話型要件定義プロンプト - {{PROJECT_DISPLAY_NAME}}

**⚠️ このファイルはAIエージェント専用です**

このプロンプトをClaude Codeで実行すると、AIエージェントが段階的に質問し、
あなたの回答をもとに完全な要件定義書を自動生成します。

---

## 📋 使用方法

### ステップ1: Claude Code起動

```bash
cd {{PROJECT_NAME}}
claude
```

### ステップ2: 以下のプロンプトを入力

```
プロジェクトを進めよう。

ai-rules/{{PROJECT_NAME}}/REQUIREMENTS_PROMPT.md を読み込んで、
対話形式で要件定義を進めてください。
```

### ステップ3: AIの質問に回答

AIが10ステップで段階的に質問します。
思いつく限り詳しく回答してください。

### ステップ4: 自動生成される成果物

以下のファイルが自動生成されます：

1. **AI向け**（詳細版）
   - `ai-rules/{{PROJECT_NAME}}/REQUIREMENTS.md`
   - `.serena/memories/project_overview.md`（更新）

2. **人間向け**（簡潔版）
   - `docs/REQUIREMENTS.md`

---

## 🤖 AIへの指示（Claude向け）

あなたはプロジェクト要件定義の専門家です。
`REQUIREMENTS_ASSISTANT.md` を参照しながら、以下の10ステップで段階的に質問してください。

### 基本方針

1. **1ステップずつ質問**
   - 一度に複数ステップを聞かない
   - ユーザーの回答を待ってから次へ

2. **回答を記録**
   - 各ステップの回答を内部的に記録
   - 後で REQUIREMENTS.md 生成時に使用

3. **具体例を提示**
   - 抽象的な質問には必ず具体例を添える
   - ユーザーが答えやすいように

4. **選択肢を提示**
   - 技術選択が必要な場合、選択肢を提示
   - ユーザーの知識レベルに応じて説明

5. **整理・提案**
   - ユーザーの回答が曖昧な場合、整理して確認
   - Phase分解、優先度付けを支援

---

## 📝 11ステップ対話フロー

### ステップ0: リファレンス資料確認（前準備）

**⚠️ 重要**: このステップを最初に実施してください。

**質問**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ステップ0/11: リファレンス資料確認（前準備）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

プロジェクトに関する既存資料を確認します。

まず、reference/ フォルダを確認します...
```

**AIの処理**:

1. **reference/ 内のファイル一覧取得**
```python
# list_dir or glob で reference/ 内を確認
files = list_directory("reference/")
```

2. **ファイル種類別に確認**

```
✅ reference/ フォルダの内容:

【打合せ議事録】
- meetings/2025-10-01_kickoff.md
- meetings/2025-10-05_requirements.pdf

【既存仕様書】
- existing_specs/current_system_spec.xlsx

【デザイン資料】
- design/wireframe_login.png
- design/mockup_dashboard.png

【データサンプル】
- data_samples/users.csv

【その他】
- (なし)
```

3. **テキストファイルを読み込み・要約**

```
📄 meetings/2025-10-01_kickoff.md を確認中...

[内容要約]
- プロジェクト名: タスク管理システム
- 参加者: A氏、B氏
- 決定事項:
  * 認証方式: JWT
  * デプロイ先: Vercel + AWS
  * 開発期間: 3ヶ月

この議事録から反映すべき要件はありますか？
```

4. **画像ファイルを表示**

```
🖼️ design/wireframe_login.png を確認中...

[画像表示]

このデザインを参考にログイン画面を実装しますか？
```

5. **ユーザーへの質問**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

reference/ フォルダ内の資料を確認しました。

以下について教えてください：

1. 議事録から反映すべき決定事項はありますか？
   （例: 認証方式、デプロイ先、スケジュール等）

2. 既存仕様書から引き継ぐべき機能はありますか？
   （例: 既存システムのDB構造、API仕様等）

3. デザイン資料を参考に実装しますか？
   （例: ワイヤーフレーム、画面モックアップ等）

4. データサンプルから把握すべきデータ構造はありますか？
   （例: CSVの列構造、JSONのスキーマ等）

5. その他、参考にすべき資料はありますか？

（自由記述でお願いします）
```

**記録項目**:
- 議事録要約（meeting_notes）
- 既存仕様（existing_specs）
- デザイン要件（design_requirements）
- データ構造（data_structure）
- その他参考情報（other_references）

---

### ステップ1: プロジェクト背景・目的

**質問**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ステップ1/10: プロジェクト背景・目的
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

このプロジェクトで解決したい課題を教えてください：

1. どんな課題を解決したいですか？
   （例: チームのタスク管理が非効率、情報共有が困難）

2. 現在はどう対応していますか？
   （例: スプレッドシート、メール、手作業）

3. このシステムで何を改善したいですか？
   （例: リアルタイム更新、自動化、可視化）
```

**記録項目**:
- 課題（problem）
- 現状（current_solution）
- 改善点（improvements）

---

### ステップ2: ユーザー・ステークホルダー

**質問**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ステップ2/10: ユーザー・ステークホルダー
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

誰がこのシステムを使いますか？

1. メインユーザー
   - 役割は？（例: チームメンバー、顧客、管理者）
   - 人数は？（初期想定と1年後想定）
   - ITリテラシーは？（高/中/低）

2. 管理者は必要ですか？
   - 必要な場合、どんな権限が必要？

3. 外部システム連携は必要ですか？
   （例: Slack通知、メール送信、決済システム）
```

**記録項目**:
- メインユーザー（main_users）
- ユーザー数（user_count）
- 管理者有無（need_admin）
- 外部連携（external_integrations）

---

### ステップ3: 主要機能の洗い出し

**質問**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ステップ3/10: 主要機能の洗い出し
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

どんな機能が必要ですか？思いつく限り挙げてください。

例:
- ユーザー登録・ログイン
- タスク作成・編集・削除
- コメント機能
- ファイルアップロード
- 通知機能
- レポート出力
- 検索機能
- その他...

（複数行で箇条書きで書いてください）
```

**AIの処理**:
ユーザーの回答を受け取ったら、以下を提案：

```
✅ 以下の機能を挙げていただきました：
[リスト表示]

これらをPhaseに分けて提案します：

【Phase 1: MVP（最小限）】
- ユーザー認証
- 基本CRUD機能
- 最低限の画面

【Phase 2: 拡張機能】
- コメント・通知
- 検索・フィルター
- ファイルアップロード

【Phase 3: 最適化・分析】
- レポート機能
- パフォーマンス改善
- UI/UX改善

この分け方で問題ありませんか？
変更したい箇所があれば教えてください。
```

**記録項目**:
- 全機能リスト（all_features）
- Phase 1機能（phase1_features）
- Phase 2機能（phase2_features）
- Phase 3機能（phase3_features）

---

### ステップ4: データモデル設計

**質問**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ステップ4/10: データモデル設計
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

どんなデータを扱いますか？

主要なエンティティ（データの塊）を挙げてください。

例:
- ユーザー（User）
  - メールアドレス、パスワード、名前
- タスク（Task）
  - タイトル、説明、ステータス、担当者
- コメント（Comment）
  - タスクに紐づく、投稿者、内容

エンティティ名と主要な属性を教えてください。
```

**AIの処理**:
ユーザーの回答を受け取ったら、ER図（テキスト形式）を提案：

```
✅ 以下のデータモデルを提案します：

User（ユーザー）
├─ id: UUID（主キー）
├─ email: string（ユニーク）
├─ password_hash: string
├─ name: string
└─ created_at: timestamp

Task（タスク）
├─ id: UUID（主キー）
├─ title: string
├─ description: text
├─ status: enum (TODO/IN_PROGRESS/DONE)
├─ assignee_id: UUID（FK → User）
├─ created_by: UUID（FK → User）
├─ created_at: timestamp
└─ updated_at: timestamp

Comment（コメント）
├─ id: UUID（主キー）
├─ task_id: UUID（FK → Task）
├─ user_id: UUID（FK → User）
├─ content: text
└─ created_at: timestamp

関連:
- User ←1:N→ Task（作成者）
- User ←1:N→ Task（担当者）
- Task ←1:N→ Comment
- User ←1:N→ Comment

この設計で問題ありませんか？
```

**記録項目**:
- エンティティリスト（entities）
- 各エンティティの属性（entity_attributes）
- 関連（relationships）

---

### ステップ5: 認証・セキュリティ

**質問**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ステップ5/10: 認証・セキュリティ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

認証方式を選んでください：

A. メール＋パスワードのみ（シンプル）
B. メール＋パスワード + OAuth（Google/GitHub）（推奨）
C. その他（具体的に説明してください）

選択: [A/B/C]

セキュリティ要件について：
1. HTTPS必須ですか？ [Y/n]
2. パスワードリセット機能は必要ですか？ [Y/n]
3. 二段階認証は必要ですか？ [y/N]
4. セッション有効期限はどのくらいが良いですか？
   （例: 1時間、1日、7日、30日）
```

**記録項目**:
- 認証方式（auth_method）
- OAuth有無（use_oauth）
- セキュリティ要件（security_requirements）
- セッション設定（session_config）

---

### ステップ6: API設計

**質問**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ステップ6/10: API設計
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

API設計について：

1. REST API / GraphQL どちらが良いですか？
   （特にこだわりがなければREST推奨）

選択: [REST/GraphQL]
```

**AIの処理**:
データモデル（ステップ4）から自動でエンドポイントを提案：

```
✅ 以下のAPIエンドポイントを提案します：

【認証】
POST   /api/auth/register       # ユーザー登録
POST   /api/auth/login          # ログイン
POST   /api/auth/logout         # ログアウト
POST   /api/auth/refresh        # トークン更新

【タスク】
GET    /api/tasks               # タスク一覧取得
POST   /api/tasks               # タスク作成
GET    /api/tasks/:id           # タスク詳細取得
PUT    /api/tasks/:id           # タスク更新
DELETE /api/tasks/:id           # タスク削除
PATCH  /api/tasks/:id/status    # ステータス更新

【コメント】
POST   /api/tasks/:id/comments  # コメント追加
GET    /api/tasks/:id/comments  # コメント一覧

【ユーザー】
GET    /api/users/me            # 自分の情報取得
PUT    /api/users/me            # 自分の情報更新

この設計で問題ありませんか？
追加したいエンドポイントがあれば教えてください。
```

**記録項目**:
- API種類（api_type）
- エンドポイント一覧（endpoints）

---

### ステップ7: 画面設計

**質問**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ステップ7/10: 画面設計
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

どんな画面が必要ですか？

主要画面を教えてください：
1. [例] ログイン画面
2. [例] ダッシュボード
3. [例] タスク一覧（カンバンボード）
4. [例] タスク詳細
5. その他...

（箇条書きで挙げてください）
```

**AIの処理**:
画面遷移図をテキストで提案：

```
✅ 以下の画面遷移図を提案します：

[未認証]
ログイン画面 ──登録→ ユーザー登録画面
     │
   ログイン成功
     ↓
[認証済み]
ダッシュボード ←→ カンバンボード（タスク一覧）
     │                 │
     │              タスククリック
     │                 ↓
     └────→ タスク詳細画面 ←→ 設定画面
                      │
                  コメント追加
                      ↓
                  コメント一覧

この遷移で問題ありませんか？
```

**記録項目**:
- 画面リスト（screens）
- 画面遷移（screen_flow）

---

### ステップ8: 非機能要件

**質問**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ステップ8/10: 非機能要件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

性能・可用性について教えてください：

1. 想定ユーザー数
   - 初期: [例: 10名]
   - 1年後: [例: 100名]

2. レスポンスタイム目標
   - ページ読み込み: [例: 3秒以内]
   - API応答: [例: 1秒以内]

3. 稼働率目標
   - [例: 95%以上、99%以上、ベストエフォート]

4. バックアップ戦略
   - 必要？ [Y/n]
   - 頻度は？ [例: 毎日、毎週]
```

**記録項目**:
- パフォーマンス要件（performance_requirements）
- 可用性要件（availability_requirements）
- スケーラビリティ（scalability）
- バックアップ戦略（backup_strategy）

---

### ステップ9: 予算・スケジュール

**質問**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ステップ9/10: 予算・スケジュール
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

予算と期限を教えてください：

1. 開発予算
   - ホスティング費用: [例: 月額$10以下、$100まで、制限なし]
   - 開発費用: [例: 無料範囲内、有料ツール使用OK]

2. スケジュール
   - Phase 1完了希望日: [例: 2025-11-01]
   - Phase 2完了希望日: [例: 2025-12-01]
   - 全体完了希望日: [例: 2026-01-31]

3. チーム構成
   - 開発者: [例: 1名（自分のみ）、2-3名]
   - デザイナー: [例: なし、1名]
   - レビュアー: [例: なし、あり]
```

**AIの処理**:
スケジュールを自動算出：

```
✅ 以下のスケジュールを提案します：

【Phase 1: MVP】2025-10-09 ~ 2025-11-01（3週間）
- ユーザー認証実装（3日）
- タスクCRUD実装（5日）
- カンバンボード実装（4日）
- E2Eテスト（2日）
- デプロイ準備（2日）

【Phase 2: 拡張機能】2025-11-02 ~ 2025-12-01（4週間）
- コメント機能（5日）
- 通知機能（5日）
- リアルタイム更新（7日）
- 検索機能（3日）
- E2Eテスト（4日）

【Phase 3: 最適化】2025-12-02 ~ 2026-01-31（8週間）
- レポート機能（10日）
- パフォーマンス最適化（7日）
- UI/UX改善（10日）
- テスト・バグ修正（13日）

この計画で問題ありませんか？
厳しい場合、優先度を調整します。
```

**記録項目**:
- 予算（budget）
- スケジュール（schedule）
- チーム構成（team）

---

### ステップ10: リスク管理

**質問**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ステップ10/10: リスク管理
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

懸念事項はありますか？

例:
- 技術的な不安（使ったことない技術スタック）
- 期限の厳しさ
- 予算制約
- チームリソース不足
- その他の懸念

（思いつく限り挙げてください）
```

**AIの処理**:
想定リスクと対策を提案：

```
✅ 以下のリスクと対策を提案します：

【リスク1】ホスティング無料プラン制限超過
- 影響度: 中
- 対策: 使用量監視、必要に応じて有料プラン

【リスク2】リアルタイム更新の実装難度
- 影響度: 高
- 対策: Phase 2でプロトタイプ検証、WebSocketライブラリ使用

【リスク3】単独開発のボトルネック
- 影響度: 中
- 対策: code-reviewer/e2e-testerサブエージェント活用

【ユーザー挙げたリスク】
[ユーザーの回答から追加]

この対策で問題ありませんか？
```

**記録項目**:
- リスク一覧（risks）
- 対策（mitigations）

---

## 🎯 最終ステップ: ドキュメント生成

全10ステップ完了後、以下を実施してください：

### 1. 内部確認

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
全10ステップ完了！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

回答を整理して以下のドキュメントを生成します：

1. ai-rules/{{PROJECT_NAME}}/REQUIREMENTS.md（詳細版、AI用）
2. docs/REQUIREMENTS.md（簡潔版、人間用）
3. .serena/memories/project_overview.md（更新）

生成を開始しますか？ [Y/n]
```

### 2. ドキュメント生成

以下のフォーマットで生成してください：

#### **`ai-rules/{{PROJECT_NAME}}/REQUIREMENTS.md`**（詳細版）

```markdown
# 要件定義 - {{PROJECT_DISPLAY_NAME}}

**作成日**: [日付]
**技術スタック**: {{BACKEND_TECH}} / {{FRONTEND_TECH}} / {{DATABASE_TYPE}}

---

## 1. プロジェクト背景・目的

### 解決したい課題
[ステップ1の回答]

### 現状
[ステップ1の回答]

### 改善点
[ステップ1の回答]

---

## 2. ユーザー・ステークホルダー

### メインユーザー
[ステップ2の回答]

### 想定ユーザー数
[ステップ2の回答]

### 管理者
[ステップ2の回答]

### 外部連携
[ステップ2の回答]

---

## 3. 主要機能

### Phase 1: MVP（最小限）
[ステップ3から生成]

### Phase 2: 拡張機能
[ステップ3から生成]

### Phase 3: 最適化・分析
[ステップ3から生成]

---

## 4. データモデル

### エンティティ一覧
[ステップ4から生成、ER図含む]

---

## 5. 認証・セキュリティ

### 認証方式
[ステップ5から生成]

### セキュリティ要件
[ステップ5から生成]

---

## 6. API設計

### エンドポイント一覧
[ステップ6から生成]

---

## 7. 画面設計

### 画面一覧
[ステップ7から生成]

### 画面遷移図
[ステップ7から生成]

---

## 8. 非機能要件

### パフォーマンス
[ステップ8から生成]

### 可用性
[ステップ8から生成]

### スケーラビリティ
[ステップ8から生成]

---

## 9. 予算・スケジュール

### 予算
[ステップ9から生成]

### スケジュール
[ステップ9から生成]

### チーム構成
[ステップ9から生成]

---

## 10. リスク管理

### 想定リスクと対策
[ステップ10から生成]

---

## 次のステップ

1. Serenaメモリ更新完了
2. Phase 1詳細設計開始
3. 初回打合せ実施（推奨）
```

#### **`docs/REQUIREMENTS.md`**（簡潔版、人間向け）

```markdown
# 要件定義 - {{PROJECT_DISPLAY_NAME}}

> **⚠️ このドキュメントは人間向けの簡潔版です**
> 詳細版は `ai-rules/{{PROJECT_NAME}}/REQUIREMENTS.md` を参照してください。

---

## 📋 プロジェクト概要

**解決する課題**: [1-2行で要約]

**主要機能**:
- [Phase 1の主要機能を3-5個]

**想定ユーザー**: [役割と人数]

**スケジュール**: Phase 1完了目標 [日付]

---

## 🎯 Phase別機能

### Phase 1: MVP
[3-5個の主要機能]

### Phase 2: 拡張機能
[3-5個の拡張機能]

### Phase 3: 最適化
[2-3個の最適化項目]

---

## 🔧 技術スタック

- **バックエンド**: {{BACKEND_TECH}}
- **フロントエンド**: {{FRONTEND_TECH}}
- **データベース**: {{DATABASE_TYPE}}
- **ホスティング**: {{HOSTING_FRONTEND}} (FE) / {{HOSTING_BACKEND}} (BE)

---

## 📊 データモデル（概要）

[主要エンティティを3-5個、簡潔に]

---

## 📅 スケジュール

| Phase | 期間 | 主要タスク |
|-------|------|-----------|
| Phase 1 | [日付] | [3-5個のタスク] |
| Phase 2 | [日付] | [3-5個のタスク] |
| Phase 3 | [日付] | [2-3個のタスク] |

---

詳細は `ai-rules/{{PROJECT_NAME}}/REQUIREMENTS.md` を参照してください。
```

#### **`.serena/memories/project_overview.md`**（更新）

既存の `project_overview.md` を以下の情報で更新：

```markdown
# プロジェクト概要 - {{PROJECT_DISPLAY_NAME}}

## 基本情報

- **プロジェクト名**: {{PROJECT_NAME}}
- **技術スタック**: {{BACKEND_TECH}} / {{FRONTEND_TECH}} / {{DATABASE_TYPE}}
- **ホスティング**: {{HOSTING_FRONTEND}} / {{HOSTING_BACKEND}}

## 目的

[ステップ1から要約]

## 主要機能

### Phase 1
[リスト]

### Phase 2
[リスト]

### Phase 3
[リスト]

## データモデル

[エンティティ一覧]

## 現在のステータス

- **現在Phase**: Phase 0（要件定義完了）
- **次のステップ**: Phase 1詳細設計

---

最終更新: [日付]
```

### 3. 確認

```
✅ 以下のドキュメントを生成しました：

1. ai-rules/{{PROJECT_NAME}}/REQUIREMENTS.md（詳細版、3500行）
2. docs/REQUIREMENTS.md（簡潔版、80行）
3. .serena/memories/project_overview.md（更新済み）

内容を確認してください。
修正が必要な箇所があれば教えてください。

[AI向けREQUIREMENTS.mdの冒頭100行を表示]

...

この内容で問題ありませんか？
```

---

## ✅ 完了条件

以下がすべて完了したら、対話型要件定義は完了です：

- [ ] 全10ステップの質問完了
- [ ] `ai-rules/{{PROJECT_NAME}}/REQUIREMENTS.md` 生成完了
- [ ] `docs/REQUIREMENTS.md` 生成完了
- [ ] `.serena/memories/project_overview.md` 更新完了
- [ ] ユーザー確認完了

次は Phase 1詳細設計に進みます。

---

**バージョン**: 1.0
**作成日**: {{CURRENT_DATE}}
